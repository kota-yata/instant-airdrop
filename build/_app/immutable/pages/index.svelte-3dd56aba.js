import{S as M,i as P,s as R,e as w,t as $,k as x,c as _,a as y,h as C,d as g,m as k,b as v,g as I,J as m,E as O,v as te,j,l as J,K as ne,L as ae,M as se,n as pe,o as E,p as ge,q as D,N as Ie,w as F,x as q,y as B,O as $e,B as H,P as Ce}from"../chunks/index-8f778956.js";import{w as z}from"../chunks/index-96763cf1.js";/* empty css                    */const Oe=()=>{const s=new Date,e=s.getHours().toString().padStart(2,"0"),t=s.getMinutes().toString().padStart(2,"0"),n=s.getSeconds().toString().padStart(2,"0");return`${e}:${t}:${n}`},W=z("No ID"),me=z([]),V=z([]),ve=z([]);class we{constructor(e){this.store=e}push(e){this.store.update(t=>(t.push(e),t))}}class G extends we{pushWithCurrentTimeStamp(e){const t={log:e,timeStamp:Oe()};this.store.update(n=>(n.push(t),n))}}function oe(s,e,t){const n=s.slice();return n[4]=e[t],n}function xe(s){let e,t;return{c(){e=w("h2"),t=$("You haven't received any data yet"),this.h()},l(n){e=_(n,"H2",{class:!0});var r=y(e);t=C(r,"You haven't received any data yet"),r.forEach(g),this.h()},h(){v(e,"class","svelte-satp9d")},m(n,r){I(n,e,r),m(e,t)},p:O,d(n){n&&g(e)}}}function ke(s){let e,t=s[0],n=[];for(let r=0;r<t.length;r+=1)n[r]=le(oe(s,t,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=J()},l(r){for(let a=0;a<n.length;a+=1)n[a].l(r);e=J()},m(r,a){for(let i=0;i<n.length;i+=1)n[i].m(r,a);I(r,e,a)},p(r,a){if(a&1){t=r[0];let i;for(i=0;i<t.length;i+=1){const l=oe(r,t,i);n[i]?n[i].p(l,a):(n[i]=le(l),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(r){ne(n,r),r&&g(e)}}}function Te(s){let e,t;return{c(){e=w("p"),t=$("No Preview")},l(n){e=_(n,"P",{});var r=y(e);t=C(r,"No Preview"),r.forEach(g)},m(n,r){I(n,e,r),m(e,t)},p:O,d(n){n&&g(e)}}}function De(s){let e,t,n;return{c(){e=w("img"),this.h()},l(r){e=_(r,"IMG",{alt:!0,src:!0,class:!0}),this.h()},h(){v(e,"alt",t=s[4].name),ae(e.src,n=s[4].url)||v(e,"src",n),v(e,"class","svelte-satp9d")},m(r,a){I(r,e,a)},p(r,a){a&1&&t!==(t=r[4].name)&&v(e,"alt",t),a&1&&!ae(e.src,n=r[4].url)&&v(e,"src",n)},d(r){r&&g(e)}}}function le(s){let e,t,n=s[4].name+"",r,a,i,l;function o(d,f){return d[4].isImage?De:Te}let h=o(s),c=h(s);return{c(){e=w("div"),t=w("h3"),r=$(n),a=x(),i=w("div"),c.c(),l=x(),this.h()},l(d){e=_(d,"DIV",{class:!0,role:!0});var f=y(e);t=_(f,"H3",{class:!0});var u=y(t);r=C(u,n),u.forEach(g),a=k(f),i=_(f,"DIV",{class:!0});var p=y(i);c.l(p),p.forEach(g),l=k(f),f.forEach(g),this.h()},h(){v(t,"class","svelte-satp9d"),v(i,"class","data-preview svelte-satp9d"),v(e,"class","data svelte-satp9d"),v(e,"role","button")},m(d,f){I(d,e,f),m(e,t),m(t,r),m(e,a),m(e,i),c.m(i,null),m(e,l)},p(d,f){f&1&&n!==(n=d[4].name+"")&&j(r,n),h===(h=o(d))&&c?c.p(d,f):(c.d(1),c=h(d),c&&(c.c(),c.m(i,null)))},d(d){d&&g(e),c.d()}}}function Ae(s){let e,t,n,r,a;function i(h,c){return h[0].length>0?ke:xe}let l=i(s),o=l(s);return{c(){e=w("div"),t=w("h2"),n=$("Data Received"),r=x(),a=w("div"),o.c(),this.h()},l(h){e=_(h,"DIV",{class:!0});var c=y(e);t=_(c,"H2",{});var d=y(t);n=C(d,"Data Received"),d.forEach(g),r=k(c),a=_(c,"DIV",{class:!0});var f=y(a);o.l(f),f.forEach(g),c.forEach(g),this.h()},h(){v(a,"class","left-data-container svelte-satp9d"),v(e,"class","left-data container svelte-satp9d")},m(h,c){I(h,e,c),m(e,t),m(t,n),m(e,r),m(e,a),o.m(a,null)},p(h,[c]){l===(l=i(h))&&o?o.p(h,c):(o.d(1),o=l(h),o&&(o.c(),o.m(a,null)))},i:O,o:O,d(h){h&&g(e),o.d()}}}function Ee(s,e,t){const n=["image/jpeg","image/png","image/webp"];let r;te(()=>{r=window.URL||window.webkitURL});let a=[],i=0;return ve.subscribe(l=>{for(let o=i;o<l.length;o++){const h=r.createObjectURL(l[o]),c=n.indexOf(l[o].type)!==-1;t(0,a=[{name:l[o].name,url:h,isImage:c},...a])}i=l.length}),[a]}class Le extends M{constructor(e){super(),P(this,e,Ee,Ae,R,{})}}function je(s){let e,t,n,r,a;return{c(){e=w("div"),t=w("h1"),n=$("Instant Drop (id: "),r=$(s[0]),a=$(")"),this.h()},l(i){e=_(i,"DIV",{class:!0});var l=y(e);t=_(l,"H1",{});var o=y(t);n=C(o,"Instant Drop (id: "),r=C(o,s[0]),a=C(o,")"),o.forEach(g),l.forEach(g),this.h()},h(){v(e,"class","left-header svelte-1iaq6zb")},m(i,l){I(i,e,l),m(e,t),m(t,n),m(t,r),m(t,a)},p(i,[l]){l&1&&j(r,i[0])},i:O,o:O,d(i){i&&g(e)}}}function Me(s,e,t){let n;return se(s,W,r=>t(0,n=r)),[n]}class Pe extends M{constructor(e){super(),P(this,e,Me,je,R,{})}}function Re(s){let e,t;return{c(){e=w("div"),t=$(s[0]),this.h()},l(n){e=_(n,"DIV",{class:!0});var r=y(e);t=C(r,s[0]),r.forEach(g),this.h()},h(){v(e,"class","icon svelte-1p8p6rp")},m(n,r){I(n,e,r),m(e,t)},p(n,[r]){r&1&&j(t,n[0])},i:O,o:O,d(n){n&&g(e)}}}function Ne(s,e,t){let{iconString:n=""}=e;return s.$$set=r=>{"iconString"in r&&t(0,n=r.iconString)},[n]}class Fe extends M{constructor(e){super(),P(this,e,Ne,Re,R,{iconString:0})}}const Y=(()=>{if(typeof self=="undefined")return!1;if("top"in self&&self!==top)try{}catch{return!1}else if("showOpenFilePicker"in self)return"showOpenFilePicker";return!1})(),qe=Y?Promise.resolve().then(function(){return Ve}):Promise.resolve().then(function(){return Ke});async function Be(...s){return(await qe).default(...s)}Y?Promise.resolve().then(function(){return Je}):Promise.resolve().then(function(){return Qe});Y?Promise.resolve().then(function(){return Ge}):Promise.resolve().then(function(){return et});const He=async s=>{const e=await s.getFile();return e.handle=s,e};var We=async(s=[{}])=>{Array.isArray(s)||(s=[s]);const e=[];s.forEach((r,a)=>{e[a]={description:r.description||"",accept:{}},r.mimeTypes?r.mimeTypes.map(i=>{e[a].accept[i]=r.extensions||[]}):e[a].accept["*/*"]=r.extensions||[]});const t=await window.showOpenFilePicker({id:s[0].id,startIn:s[0].startIn,types:e,multiple:s[0].multiple||!1,excludeAcceptAllOption:s[0].excludeAcceptAllOption||!1}),n=await Promise.all(t.map(He));return s[0].multiple?n:n[0]},Ve={__proto__:null,default:We};function U(s){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:n}})}return U=function(t){this.s=t,this.n=t.next},U.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?Promise.reject(t):e(n.apply(this.s,arguments))}},new U(s)}const _e=async(s,e,t=s.name,n)=>{const r=[],a=[];var i,l=!1,o=!1;try{for(var h,c=function(d){var f,u,p,S=2;for(typeof Symbol!="undefined"&&(u=Symbol.asyncIterator,p=Symbol.iterator);S--;){if(u&&(f=d[u])!=null)return f.call(d);if(p&&(f=d[p])!=null)return new U(f.call(d));u="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}(s.values());l=!(h=await c.next()).done;l=!1){const d=h.value,f=`${t}/${d.name}`;d.kind==="file"?a.push(d.getFile().then(u=>(u.directoryHandle=s,u.handle=d,Object.defineProperty(u,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>f})))):d.kind!=="directory"||!e||n&&n(d)||r.push(_e(d,e,f,n))}}catch(d){o=!0,i=d}finally{try{l&&c.return!=null&&await c.return()}finally{if(o)throw i}}return[...(await Promise.all(r)).flat(),...await Promise.all(a)]};var Ue=async(s={})=>{s.recursive=s.recursive||!1;const e=await window.showDirectoryPicker({id:s.id,startIn:s.startIn});return _e(e,s.recursive,void 0,s.skipDirectory)},Je={__proto__:null,default:Ue},ze=async(s,e=[{}],t=null,n=!1,r=null)=>{Array.isArray(e)||(e=[e]),e[0].fileName=e[0].fileName||"Untitled";const a=[];let i=null;if(s instanceof Blob&&s.type?i=s.type:s.headers&&s.headers.get("content-type")&&(i=s.headers.get("content-type")),e.forEach((h,c)=>{a[c]={description:h.description||"",accept:{}},h.mimeTypes?(c===0&&i&&h.mimeTypes.push(i),h.mimeTypes.map(d=>{a[c].accept[d]=h.extensions||[]})):i&&(a[c].accept[i]=h.extensions||[])}),t)try{await t.getFile()}catch(h){if(t=null,n)throw h}const l=t||await window.showSaveFilePicker({suggestedName:e[0].fileName,id:e[0].id,startIn:e[0].startIn,types:a,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1});!t&&r&&r();const o=await l.createWritable();return"stream"in s?(await s.stream().pipeTo(o),l):"body"in s?(await s.body.pipeTo(o),l):(await o.write(await s),await o.close(),l)},Ge={__proto__:null,default:ze},Ye=async(s=[{}])=>(Array.isArray(s)||(s=[s]),new Promise((e,t)=>{const n=document.createElement("input");n.type="file";const r=[...s.map(l=>l.mimeTypes||[]),...s.map(l=>l.extensions||[])].join();n.multiple=s[0].multiple||!1,n.accept=r||"";const a=l=>{typeof i=="function"&&i(),e(l)},i=s[0].legacySetup&&s[0].legacySetup(a,()=>i(t),n);n.addEventListener("change",()=>{a(n.multiple?Array.from(n.files):n.files[0])}),n.click()})),Ke={__proto__:null,default:Ye},Ze=async(s=[{}])=>(Array.isArray(s)||(s=[s]),s[0].recursive=s[0].recursive||!1,new Promise((e,t)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=i=>{typeof a=="function"&&a(),e(i)},a=s[0].legacySetup&&s[0].legacySetup(r,()=>a(t),n);n.addEventListener("change",()=>{let i=Array.from(n.files);s[0].recursive?s[0].recursive&&s[0].skipDirectory&&(i=i.filter(l=>l.webkitRelativePath.split("/").every(o=>!s[0].skipDirectory({name:o,kind:"directory"})))):i=i.filter(l=>l.webkitRelativePath.split("/").length===2),r(i)}),n.click()})),Qe={__proto__:null,default:Ze},Xe=async(s,e={})=>{Array.isArray(e)&&(e=e[0]);const t=document.createElement("a");let n=s;"body"in s&&(n=await async function(i,l){const o=i.getReader(),h=new ReadableStream({start:f=>async function u(){return o.read().then(({done:p,value:S})=>{if(!p)return f.enqueue(S),u();f.close()})}()}),c=new Response(h),d=await c.blob();return o.releaseLock(),new Blob([d],{type:l})}(s.body,s.headers.get("content-type"))),t.download=e.fileName||"Untitled",t.href=URL.createObjectURL(await n);const r=()=>{typeof a=="function"&&a()},a=e.legacySetup&&e.legacySetup(r,()=>a(),t);return t.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(t.href),3e4),r()}),t.click(),null},et={__proto__:null,default:Xe};class re{constructor(e,t,n,r){this.log="",this.timeStamp="",this.dataType=e,e==="Peers"?this.listData=t:this.stringData=t,this.log&&this.timeStamp&&(this.log=n,this.timeStamp=r)}toString(){return JSON.stringify(this)}}class ie{constructor(e,t,n){this.from=e,this.to=t,this.offer=n}toString(){return JSON.stringify(this)}}const tt=s=>{let e=64;const t=8,n=1,r=e-t-n,a=encodeURI(s).replace(/%../g,"*").length,i=a%64;r<i&&(e=128);const o=Array.from(new TextEncoder().encode(s)).map(p=>p.toString(16)).join(""),h=(e-t-n-i)*2,c=Array(h).fill(0).join(""),d=(a*8).toString(16),f=Array(16-d.length).fill(0).concat(d).join("");return o+"80"+c+f},nt=s=>{const e=s.match(/.{128}/g);if(!e)throw new Error("Failed to divide message");return e},st=(s,e,t)=>(s&e^~s&t)>>>0,rt=(s,e,t)=>(s&e^s&t^e&t)>>>0,A=(s,e)=>(s>>>e|s<<32-e)>>>0,ye=(s,e)=>s>>>e>>>0,it=s=>(A(s,2)^A(s,13)^A(s,22))>>>0,at=s=>(A(s,6)^A(s,11)^A(s,25))>>>0,ot=s=>(A(s,7)^A(s,18)^ye(s,3))>>>0,lt=s=>(A(s,17)^A(s,19)^ye(s,10))>>>0,ct=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ht=(s,e)=>{for(let t=0;t<64;t++){const n=parseInt(e[t],16);if(t<16){s[t]=n;continue}const r=lt(s[t-2])+s[t-7]+ot(s[t-15])+s[t-16];s[t]=(r&4294967295)>>>0}return s},X=s=>{const e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],t=tt(s),n=nt(t);for(let a=0;a<n.length;a++){const i=n[a].match(/.{8}/g);if(!i)throw new Error("Failed to divide dividedM");const l=ht(Array(64),i);let[o,h,c,d,f,u,p,S]=[...e];for(let b=0;b<64;b++){const T=(S+at(f)+st(f,u,p)+ct[b]+l[b]&4294967295)>>>0,N=(it(o)+rt(o,h,c)&4294967295)>>>0;S=p,p=u,u=f,f=(d+T&4294967295)>>>0,d=c,c=h,h=o,o=(T+N&4294967295)>>>0}e[0]=(o+e[0]&4294967295)>>>0,e[1]=(h+e[1]&4294967295)>>>0,e[2]=(c+e[2]&4294967295)>>>0,e[3]=(d+e[3]&4294967295)>>>0,e[4]=(f+e[4]&4294967295)>>>0,e[5]=(u+e[5]&4294967295)>>>0,e[6]=(p+e[6]&4294967295)>>>0,e[7]=(S+e[7]&4294967295)>>>0}let r="";for(let a=0;a<e.length;a++){let i=e[a].toString(16);i.length<8&&(i=Array(8-i.length).fill(0).join("")+i),r+=i}if(r.length!==64)throw new Error("Hash result is not 32bytes");return r};class dt{constructor(){this.fragments={},this.logStore=new G(V)}add(e,t){const n=t.fileObject;if(!t.fileObject.isFragmented)return this.fragments[e]=[t],this.logStore.pushWithCurrentTimeStamp(`DataID: ${e} received`),!0;const r=n.fragment.total;return this.fragments[e]||(this.fragments[e]=new Array(r).fill(null),this.logStore.pushWithCurrentTimeStamp(`Receiving dataID: ${e}...`)),this.fragments[e][n.fragment.index-1]=t,this.fragments[e].findIndex(i=>i===null)===-1?(this.logStore.pushWithCurrentTimeStamp(`All the fragments of dataID: ${e} received`),!0):!1}toFile(e){const t=this.fragments[e],n=t[0].fileObject.name,r=t[0].fileObject.type,a=t.length===1?[t[0].arrayBuffer]:t.map(l=>l.arrayBuffer),i=new File(a,n,{type:r});return delete this.fragments[e],i}}const Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ft=(s,e)=>{let t=0;const n=e%3;n===0?t=2:n===1?t=4:n===2&&(t=6);const r=s>>>t,a=(s<<6-t)%64;return{mainBits:r,extraBits:a}},ut=s=>{let e=0;const t=[];for(let n=0;n<s.length;n++){const r=s[n],a=ft(r,n),i=a.mainBits+e;t.push(i),n%3===2||n===s.length-1?(t.push(a.extraBits),e=0):e=a.extraBits}return t},pt=s=>{const e=s.length%4===0?0:4-s.length%4;let t="";return s.map(n=>{t+=Se[n]}),t+="=".repeat(e),t},gt=s=>{const e=new Uint8Array(s),t=ut(e);return pt(t)},mt=s=>{const e=s.replace(/=/g,"").split(""),t=e.length*6/8,n=new Uint8Array(t);let r=0,a=0;for(let i=0;i<e.length;i++){const l=Se.indexOf(e[i]),o=i%4;if(o===0||o===4){r=l<<2;continue}const h=6-o*2;r+=l>>>h,n[a]=r,a++,r=(l<<8-h)%256}return n},vt=s=>mt(s).buffer;class ee{static encode(e){return gt(e)}static decode(e){return vt(e)}}class be{constructor(e,t){this.CONFIG={iceServers:[{urls:"stun:stun.1.google.com:19302"}]},this.waitingFileObject=this.waitingArrayBuffer=[],this.fragments=new dt,this.fileStore=new we(ve),this.logStore=new G(V),this.ws=e,this.remoteId=t,W.subscribe(n=>{this.localId=n}),this.peerConnection=new RTCPeerConnection(this.CONFIG),this.dataChannel=this.peerConnection.createDataChannel("File Transfer",{negotiated:!0,id:0}),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=()=>{this.logStore.pushWithCurrentTimeStamp("RTC Data Channel is open")},this.dataChannel.onmessage=n=>{this.handleMessage(n)},this.peerConnection.onicecandidate=n=>{this.elIceCandidate(n)},this.peerConnection.onconnectionstatechange=()=>{this.elConnectionStateChange()}}elIceCandidate(e){if(!e.candidate)return;const t=new ie(this.localId,this.remoteId,JSON.stringify(e.candidate)).toString(),n=new re("IceCandidate",t).toString();this.ws.sendMessage(n)}elConnectionStateChange(){this.logStore.pushWithCurrentTimeStamp(`Connection state changed: ${this.peerConnection.connectionState}`)}async createOffer(){const e=await this.peerConnection.createOffer({iceRestart:!1,offerToReceiveAudio:!1,offerToReceiveVideo:!1});return await this.peerConnection.setLocalDescription(e),e}async createAnswer(e){await this.peerConnection.setRemoteDescription(e);const t=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(t),t}async handleAnswer(e){const t=new RTCSessionDescription(e);await this.peerConnection.setRemoteDescription(t)}handleMessage(e){const t=e.data;let n="Not Found";if(typeof t=="string"){const a=JSON.parse(t);n=this.handleFileObject(a)}else n=this.handleArrayBuffer(t);if(n==="Not Found"||!n)return;const r=this.fragments.toFile(n);this.fileStore.push(r)}handleFileObject(e){const t=this.waitingArrayBuffer.find(a=>{const i=ee.encode(a);return X(i)===e.dataHash});return t?this.fragments.add(e.dataId,{fileObject:e,arrayBuffer:t})?e.dataId:"Not Found":(this.waitingFileObject.push(e),"Not Found")}handleArrayBuffer(e){const t=ee.encode(e),n=this.waitingFileObject.find(i=>i.dataHash===X(t));return n?this.fragments.add(n.dataId,{fileObject:n,arrayBuffer:e})?n.dataId:"Not Found":(this.waitingArrayBuffer.push(e),"Not Found")}send(e){if(this.dataChannel.readyState==="open"){this.dataChannel.send(e);return}setTimeout(()=>{this.send(e)},2e3)}async addIceCandidate(e){this.peerConnection.addIceCandidate(e).catch(t=>{throw this.logStore.pushWithCurrentTimeStamp("Something went wrong during adding a new ICE candidate"),Error(t)})}}class ce{constructor(e,t,n,r,a,i){this.name=e,this.dataId=t,this.type=n;const l=ee.encode(r);this.dataHash=X(l),this.isFragmented=a,a&&(this.fragment=i)}}const wt=async(s,e)=>{if(s.size<=16e3){const a=await s.arrayBuffer();return[[new ce(s.name,e,s.type,a,!1),a]]}const n=[],r=Math.ceil(s.size/16e3);for(let a=1;a<=r;a++){const i=16e3*(a-1),l=16e3*a,h=await s.slice(i,l,s.type).arrayBuffer(),c=new ce(s.name,e,s.type,h,!0,{total:r,index:a});n.push([c,h])}return n};function he(s,e,t){const n=s.slice();return n[8]=e[t],n}function _t(s){let e,t;return{c(){e=w("h2"),t=$("Searching peers nearby...")},l(n){e=_(n,"H2",{});var r=y(e);t=C(r,"Searching peers nearby..."),r.forEach(g)},m(n,r){I(n,e,r),m(e,t)},p:O,i:O,o:O,d(n){n&&g(e)}}}function yt(s){let e,t,n=s[0],r=[];for(let i=0;i<n.length;i+=1)r[i]=de(he(s,n,i));const a=i=>E(r[i],1,1,()=>{r[i]=null});return{c(){for(let i=0;i<r.length;i+=1)r[i].c();e=J()},l(i){for(let l=0;l<r.length;l+=1)r[l].l(i);e=J()},m(i,l){for(let o=0;o<r.length;o+=1)r[o].m(i,l);I(i,e,l),t=!0},p(i,l){if(l&3){n=i[0];let o;for(o=0;o<n.length;o+=1){const h=he(i,n,o);r[o]?(r[o].p(h,l),D(r[o],1)):(r[o]=de(h),r[o].c(),D(r[o],1),r[o].m(e.parentNode,e))}for(pe(),o=n.length;o<r.length;o+=1)a(o);ge()}},i(i){if(!t){for(let l=0;l<n.length;l+=1)D(r[l]);t=!0}},o(i){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)E(r[l]);t=!1},d(i){ne(r,i),i&&g(e)}}}function de(s){let e,t,n,r,a=s[8].id+"",i,l,o,h,c;t=new Fe({props:{iconString:s[8].icon}});function d(){return s[3](s[8])}return{c(){e=w("div"),F(t.$$.fragment),n=x(),r=w("h2"),i=$(a),l=x(),this.h()},l(f){e=_(f,"DIV",{class:!0,role:!0});var u=y(e);q(t.$$.fragment,u),n=k(u),r=_(u,"H2",{class:!0});var p=y(r);i=C(p,a),p.forEach(g),l=k(u),u.forEach(g),this.h()},h(){v(r,"class","svelte-10clts"),v(e,"class","peer svelte-10clts"),v(e,"role","button")},m(f,u){I(f,e,u),B(t,e,null),m(e,n),m(e,r),m(r,i),m(e,l),o=!0,h||(c=$e(e,"click",d),h=!0)},p(f,u){s=f;const p={};u&1&&(p.iconString=s[8].icon),t.$set(p),(!o||u&1)&&a!==(a=s[8].id+"")&&j(i,a)},i(f){o||(D(t.$$.fragment,f),o=!0)},o(f){E(t.$$.fragment,f),o=!1},d(f){f&&g(e),H(t),h=!1,c()}}}function St(s){let e,t,n,r;const a=[yt,_t],i=[];function l(o,h){return o[0].length>0?0:1}return t=l(s),n=i[t]=a[t](s),{c(){e=w("div"),n.c(),this.h()},l(o){e=_(o,"DIV",{class:!0});var h=y(e);n.l(h),h.forEach(g),this.h()},h(){v(e,"class","left-peers svelte-10clts")},m(o,h){I(o,e,h),i[t].m(e,null),r=!0},p(o,[h]){let c=t;t=l(o),t===c?i[t].p(o,h):(pe(),E(i[c],1,1,()=>{i[c]=null}),ge(),n=i[t],n?n.p(o,h):(n=i[t]=a[t](o),n.c()),D(n,1),n.m(e,null))},i(o){r||(D(n),r=!0)},o(o){E(n),r=!1},d(o){o&&g(e),i[t].d()}}}function bt(s,e,t){let n,r;se(s,W,d=>t(4,r=d));var a=this&&this.__awaiter||function(d,f,u,p){function S(b){return b instanceof u?b:new u(function(T){T(b)})}return new(u||(u=Promise))(function(b,T){function N(L){try{Z(p.next(L))}catch(Q){T(Q)}}function K(L){try{Z(p.throw(L))}catch(Q){T(Q)}}function Z(L){L.done?b(L.value):S(L.value).then(N,K)}Z((p=p.apply(d,f||[])).next())})};let{ws:i}=e;const l=new G(V),o=me.subscribe(d=>{t(0,n=d.filter(f=>f.id!==r))});Ie(()=>{o()}),te(()=>{Y?l.pushWithCurrentTimeStamp("File System Access API is supported"):l.pushWithCurrentTimeStamp("File System Access API is not supported")});const h=d=>a(void 0,void 0,void 0,function*(){let f,u=i.rtcInstanceList.find(p=>p.id===d);if(u)f=u.rtc,l.pushWithCurrentTimeStamp(`Using an existing connection with ${d}`);else{f=new be(i,d),i.rtcInstanceList.push({id:d,rtc:f});const p=yield f.createOffer(),S=new ie(r,d,JSON.stringify(p)).toString(),b=new re("Offer",S).toString();i.sendMessage(b)}try{(yield Be({multiple:!0})).map((S,b)=>a(void 0,void 0,void 0,function*(){(yield wt(S,`${r}-${b}`)).map(([N,K])=>{f.send(JSON.stringify(N)),f.send(K)}),console.log("sent")}))}catch(p){if(p.name==="AbortError")return;l.pushWithCurrentTimeStamp("Something went wrong while opening files"),console.error(p)}}),c=d=>{h(d.id)};return s.$$set=d=>{"ws"in d&&t(2,i=d.ws)},t(0,n=[]),[n,h,i,c]}class It extends M{constructor(e){super(),P(this,e,bt,St,R,{ws:2})}}function fe(s,e,t){const n=s.slice();return n[1]=e[t],n}function ue(s){let e,t,n=s[1].timeStamp+"",r,a,i,l=s[1].log+"",o,h;return{c(){e=w("div"),t=w("div"),r=$(n),a=x(),i=w("div"),o=$(l),h=x(),this.h()},l(c){e=_(c,"DIV",{class:!0});var d=y(e);t=_(d,"DIV",{class:!0});var f=y(t);r=C(f,n),f.forEach(g),a=k(d),i=_(d,"DIV",{class:!0});var u=y(i);o=C(u,l),u.forEach(g),h=k(d),d.forEach(g),this.h()},h(){v(t,"class","right-log-container-timeStamp svelte-qfc0cq"),v(i,"class","right-log-container-log"),v(e,"class","svelte-qfc0cq")},m(c,d){I(c,e,d),m(e,t),m(t,r),m(e,a),m(e,i),m(i,o),m(e,h)},p(c,d){d&1&&n!==(n=c[1].timeStamp+"")&&j(r,n),d&1&&l!==(l=c[1].log+"")&&j(o,l)},d(c){c&&g(e)}}}function $t(s){let e,t,n,r,a,i=s[0],l=[];for(let o=0;o<i.length;o+=1)l[o]=ue(fe(s,i,o));return{c(){e=w("div"),t=w("h2"),n=$("Connection Log"),r=x(),a=w("div");for(let o=0;o<l.length;o+=1)l[o].c();this.h()},l(o){e=_(o,"DIV",{class:!0});var h=y(e);t=_(h,"H2",{});var c=y(t);n=C(c,"Connection Log"),c.forEach(g),r=k(h),a=_(h,"DIV",{class:!0});var d=y(a);for(let f=0;f<l.length;f+=1)l[f].l(d);d.forEach(g),h.forEach(g),this.h()},h(){v(a,"class","right-log-container svelte-qfc0cq"),v(e,"class","right-log container svelte-qfc0cq")},m(o,h){I(o,e,h),m(e,t),m(t,n),m(e,r),m(e,a);for(let c=0;c<l.length;c+=1)l[c].m(a,null)},p(o,[h]){if(h&1){i=o[0];let c;for(c=0;c<i.length;c+=1){const d=fe(o,i,c);l[c]?l[c].p(d,h):(l[c]=ue(d),l[c].c(),l[c].m(a,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=i.length}},i:O,o:O,d(o){o&&g(e),ne(l,o)}}}function Ct(s,e,t){let n;return se(s,V,r=>t(0,n=r)),[n]}class Ot extends M{constructor(e){super(),P(this,e,Ct,$t,R,{})}}class xt{constructor(){this.rtcInstanceList=[],this.isOpen=!1,this.logListStore=new G(V),W.subscribe(e=>{this.localId=e});try{this.ws=new WebSocket("wss://wsjava.herokuapp.com/ws"),this.logListStore.pushWithCurrentTimeStamp("Connecting to the signaling server...")}catch(e){throw this.logListStore.pushWithCurrentTimeStamp("Failed to connect to the signaling server"),Error(e)}this.ws.onerror=()=>{this.logListStore.pushWithCurrentTimeStamp("Something went wrong on WebSocket")},this.ws.onopen=()=>{this.isOpen=!0},this.ws.onmessage=e=>{this.handleMessage(e)}}sendMessage(e){if(this.isOpen){this.ws.send(e);return}setTimeout(()=>{this.sendMessage(e)},5e3)}async handleMessage(e){const t=JSON.parse(e.data);switch(this.logListStore.push({log:t.log,timeStamp:t.timeStamp}),t.dataType){case"LocalId":this.handleMessageLocalId(t);break;case"Peers":this.handleMessagePeers(t);break;case"Offer":await this.handleMessageOffer(t);break;case"Answer":await this.handleMessageAnswer(t);break;case"IceCandidate":this.handleMessageIceCandidate(t);break;default:this.logListStore.pushWithCurrentTimeStamp("Unknown message detected")}}handleMessageLocalId(e){W.set(e.stringData)}handleMessagePeers(e){const t=e.listData.split(",").map(n=>({id:n,icon:"\u{1F600}"}));me.set(t)}async handleMessageOffer(e){const t=JSON.parse(e.stringData);if(this.rtcInstanceList.find(h=>h.id===t.from)){this.logListStore.pushWithCurrentTimeStamp(`The connection with ${t.from} has already been established`);return}const r=new be(this,t.from);this.rtcInstanceList.push({id:t.from,rtc:r});const a=JSON.parse(t.offer),i=await r.createAnswer(a),l=new ie(this.localId,t.from,JSON.stringify(i)).toString(),o=new re("Answer",l).toString();this.sendMessage(o)}async handleMessageAnswer(e){const t=JSON.parse(e.stringData),n=JSON.parse(t.offer),r=this.rtcInstanceList.find(a=>a.id===t.from);if(!r){const a="The corresponding RTC instance to the ID was not found";throw this.logListStore.pushWithCurrentTimeStamp(a),new Error(a)}await r.rtc.handleAnswer(n),this.logListStore.pushWithCurrentTimeStamp(`P2P connection with peer ID: ${t.from} established`)}handleMessageIceCandidate(e){const t=JSON.parse(e.stringData),n=this.rtcInstanceList.find(r=>r.id===t.from);if(!n){this.logListStore.pushWithCurrentTimeStamp("Corresponding RTC instance to the remote peer was not found");return}n.rtc.addIceCandidate(JSON.parse(t.offer))}}function kt(s){let e,t,n,r,a,i,l,o,h,c,d,f;return r=new Pe({}),i=new It({props:{ws:s[0]}}),o=new Le({}),d=new Ot({}),{c(){e=x(),t=w("div"),n=w("div"),F(r.$$.fragment),a=x(),F(i.$$.fragment),l=x(),F(o.$$.fragment),h=x(),c=w("div"),F(d.$$.fragment),this.h()},l(u){Ce('[data-svelte="svelte-1291iom"]',document.head).forEach(g),e=k(u),t=_(u,"DIV",{class:!0});var S=y(t);n=_(S,"DIV",{class:!0});var b=y(n);q(r.$$.fragment,b),a=k(b),q(i.$$.fragment,b),l=k(b),q(o.$$.fragment,b),b.forEach(g),h=k(S),c=_(S,"DIV",{class:!0});var T=y(c);q(d.$$.fragment,T),T.forEach(g),S.forEach(g),this.h()},h(){document.title="Home | Instant Drop",v(n,"class","left svelte-wtwhmo"),v(c,"class","right svelte-wtwhmo"),v(t,"class","index svelte-wtwhmo")},m(u,p){I(u,e,p),I(u,t,p),m(t,n),B(r,n,null),m(n,a),B(i,n,null),m(n,l),B(o,n,null),m(t,h),m(t,c),B(d,c,null),f=!0},p(u,[p]){const S={};p&1&&(S.ws=u[0]),i.$set(S)},i(u){f||(D(r.$$.fragment,u),D(i.$$.fragment,u),D(o.$$.fragment,u),D(d.$$.fragment,u),f=!0)},o(u){E(r.$$.fragment,u),E(i.$$.fragment,u),E(o.$$.fragment,u),E(d.$$.fragment,u),f=!1},d(u){u&&g(e),u&&g(t),H(r),H(i),H(o),H(d)}}}function Tt(s,e,t){let n;return te(()=>{t(0,n=new xt)}),[n]}class Lt extends M{constructor(e){super(),P(this,e,Tt,kt,R,{})}}export{Lt as default};
